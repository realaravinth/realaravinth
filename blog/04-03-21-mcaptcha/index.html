<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Aravinth Manivannan ">
<meta name="description" content="While working on Identity, I noticed some of the endpoints were computationally expensive. The target platforms for Shuttlecraft systems are cheap computers such as Raspberry Pis so I learned a new language and picked up a new web framework among many things, to make things go faster. And those computationally expensive endpoints were dog slow and vulnerable to denial-of-service attacks if left unprotected.
I came up with the following ways to rate-limit those endpoints:" />
<meta name="keywords" content=", mCaptcha" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://batsense.net/blog/04-03-21-mcaptcha/" />


    <title>
        
            mCaptcha - to hell with captchas! :: realaravinth | Aravinth Manivannan 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.29c2c8c3fc9cf748254138351f142ac2833b208a68e83aec126edc98b59efef2.css">






<meta itemprop="name" content="mCaptcha - to hell with captchas!">
<meta itemprop="description" content="While working on Identity, I noticed some of the endpoints were computationally expensive. The target platforms for Shuttlecraft systems are cheap computers such as Raspberry Pis so I learned a new language and picked up a new web framework among many things, to make things go faster. And those computationally expensive endpoints were dog slow and vulnerable to denial-of-service attacks if left unprotected.
I came up with the following ways to rate-limit those endpoints:">
<meta itemprop="datePublished" content="2021-03-04T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-03-04T00:00:00+00:00" />
<meta itemprop="wordCount" content="675">
<meta itemprop="image" content="https://batsense.net/"/>



<meta itemprop="keywords" content="mCaptcha," />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://batsense.net/"/>

<meta name="twitter:title" content="mCaptcha - to hell with captchas!"/>
<meta name="twitter:description" content="While working on Identity, I noticed some of the endpoints were computationally expensive. The target platforms for Shuttlecraft systems are cheap computers such as Raspberry Pis so I learned a new language and picked up a new web framework among many things, to make things go faster. And those computationally expensive endpoints were dog slow and vulnerable to denial-of-service attacks if left unprotected.
I came up with the following ways to rate-limit those endpoints:"/>




    <meta property="og:title" content="mCaptcha - to hell with captchas!" />
<meta property="og:description" content="While working on Identity, I noticed some of the endpoints were computationally expensive. The target platforms for Shuttlecraft systems are cheap computers such as Raspberry Pis so I learned a new language and picked up a new web framework among many things, to make things go faster. And those computationally expensive endpoints were dog slow and vulnerable to denial-of-service attacks if left unprotected.
I came up with the following ways to rate-limit those endpoints:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://batsense.net/blog/04-03-21-mcaptcha/" />
<meta property="og:image" content="https://batsense.net/"/>
<meta property="article:published_time" content="2021-03-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-03-04T00:00:00+00:00" /><meta property="og:site_name" content="realaravinth | Aravinth Manivannan" />






    <meta property="article:published_time" content="2021-03-04 00:00:00 &#43;0000 UTC" />










    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">realaravinth</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about">About</a></li><li><a href="/blog">Blog</a></li><li><a href="/contact">Contact</a></li><li><a href="/donate">Donate</a></li><li><a href="/services">Services</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://batsense.net/blog/04-03-21-mcaptcha/">mCaptcha - to hell with captchas!</a></h2>

            
            
            

            <div class="post-content">
                <p>While working on <a href="https://github.com/shuttlecraft/identity">Identity</a>, I
noticed some of the endpoints were computationally expensive. The target
platforms for Shuttlecraft systems are cheap computers such as Raspberry
Pis so I learned a <a href="https://rust-lang.org">new language</a> and picked up a
new <a href="https://actix.rs">web framework</a> among many things, to make things
go faster. And those computationally expensive endpoints were dog slow
and vulnerable to denial-of-service attacks if left unprotected.</p>
<p>I came up with the following ways to rate-limit those endpoints:</p>
<ol>
<li>Captcha: reCaptcha/hCAptcha types</li>
<li>IP based filtering: <code>x</code> requests per IP address during a specific
interval of time</li>
<li>Do nothing: there&rsquo;s only so much that you can do :p</li>
</ol>
<p>Let&rsquo;s analyse each one of these solutions.</p>
<h2 id="1-captcha">1. Captcha:</h2>
<h3 id="pros">Pros:</h3>
<ul>
<li>Captcha widgets are the norm for detecting bot activity.</li>
<li>Large companies like Google and Cloudflare are invested in making
captchas work.</li>
<li>Machine learning is used study bot activity and flag users down
whenever there&rsquo;s a resemblance.</li>
<li>No user learning curve: netizens are familiar with captchas</li>
</ul>
<h3 id="cons">Cons:</h3>
<ul>
<li>
<p><strong>Proprietary software:</strong> what is the backend doing? What sort of
algorithms are they using? Do they exhibit unfair bias when letting
users through? We will never know. We have to take them by their word
and have no way of verifying their claims. They can, in effect, ban
users from visiting your website if they wanted to do.</p>
</li>
<li>
<p><strong>Privacy invasive:</strong> Captchas mine data. I have Google domains
blacklisted by default and every time I visit a site that uses
Google&rsquo;s reCaptcha, I am forced to temporarily whitelist them. I don&rsquo;t
like doing that.</p>
</li>
<li>
<p><strong>Annoying:</strong> It sucks that I have to manually solve captchas to tell
a website that I am, in fact, a legitimate user. We should have
automated this stuff a long time ago!</p>
</li>
</ul>
<h5 id="anecdote"></h5>
<blockquote>
<p><strong>True story:</strong> My university has a student portal that we use to submit
assignments and view scorecards. They have a dumb captcha at the
sign-in page to keep bots away. The IT staff figured they&rsquo;ll be better
protected if they replace it with reCaptcha. And they did.
<figure>
    <img src="/img/blog/04-03-21-mcaptcha/portal-dumb-captcha.png"
         alt="dumb captcha university portal"/> <figcaption>
            <p>dumb captcha university portal</p>
        </figcaption>
</figure>
 &gt;
I have terrible luck with captcha systems. They always flag me as
a bot. So after this change, when I went online to upload an
assignment, I had to solve 49 captchas <em>and</em> get flagged as a bot and do
another 49 only to get flagged as a bot again. Only this time, Google
wouldn&rsquo;t let me try again and asked me to &ldquo;try again later&rdquo;.</p>
<p>Luckily I wasn&rsquo;t alone. You see, my university is behind a
<a href="https://en.wikipedia.org/wiki/Network_address_translation">NAT</a> so
10,000 people share a single public IP address. From Google&rsquo;s
perspective, we would appear as a giant bot that generates a lot of
traffic(stopped using Google search after I moved there because of all
the captchas that they made me solve).</p>
<p>The next day, the IT team rolled back to the old dumb captchas</p>
</blockquote>
<h2 id="2-ip-based-filtering">2. IP based filtering:</h2>
<h3 id="pros-1">Pros:</h3>
<ul>
<li>
<p><strong>Easy to implement:</strong> IP addresses are ubiquitous on the internet</p>
</li>
<li>
<p><strong>Stateful:</strong> Unless and until users are hopping between networks,
they&rsquo;ll have the same IP address throughout their session with the
site. So it&rsquo;s trivially easy to use it as an ID to rate-limit clients.</p>
</li>
</ul>
<h3 id="cons-1">Cons:</h3>
<p>There&rsquo;s only one that I could think of:</p>
<ul>
<li><strong>Doesn&rsquo;t work for people behind NAT:</strong> When multiple users are
using the same IP address, there isn&rsquo;t an effective way to uniquely
identify each one of them. So an IP-based mechanism would fail in such
situations.</li>
</ul>
<p><a href="#anecdote">See previous section</a> for anecdotal evidence.</p>
<h2 id="3-dont-do-anything">3. Don&rsquo;t do anything:</h2>
<p>Not really an option.</p>
<hr>
<p>So what we need is something that that will work behind NATs, is privacy
respecting but most importantly, it should be free(as in freedom)</p>
<h2 id="enter-mcaptcha">Enter mCaptcha</h2>
<p>mCaptcha is a proof-of-work(PoW) based rate-limiting system that uses
variable difficulty.</p>
<p>When a user visits a mCaptcha enabled website,
their client automatically generates a PoW to qualify for performing an
action(submitting forms, etc.). This enforces a rate-limit.</p>
<p>When the server is under load, the difficulty will rise to make the
clients spend more time preparing the request than the server processing
the request. This makes DoS attacks expensive for the attackers as well.</p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="https://batsense.net/tags/mcaptcha/">mCaptcha</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.ace63d93098bf623f7c286a9084a4c22bfc482944c734f87fe0b685c7c6c7fa0ad2edb028c3b4b60d3343720c8ab490b320ad7f8edf4f6e9a6b898fc529057a9.js" integrity="sha512-rOY9kwmL9iP3woapCEpMIr/EgpRMc0&#43;H/gtoXHxsf6CtLtsCjDtLYNM0NyDIq0kLMgrX&#43;O309ummuJj8UpBXqQ=="></script>



    </body>
</html>
