<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
	<title> - self-hosting</title>
	<link href="https://batsense.net/tags/self-hosting/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="https://batsense.net"/>
	<generator uri="https://www.getzola.org/">Zola</generator>
	<updated>2021-09-10T00:00:00+00:00</updated>
	<id>https://batsense.net/tags/self-hosting/atom.xml</id>
	<entry xml:lang="en">
		<title>Ideal backup situation</title>
		<published>2021-09-10T00:00:00+00:00</published>
		<updated>2021-09-10T00:00:00+00:00</updated>
		<link href="https://batsense.net/blog/10-09-2021-ideal-backup-situation/" type="text/html"/>
		<id>https://batsense.net/blog/10-09-2021-ideal-backup-situation/</id>
		<content type="html">&lt;p&gt;I&#x27;ve been playing fast and loose with backups, and I&#x27;ve been extremely
fortunate to have not suffered any serious system failures or data
loses. I recently recovered from systems failures on my Raspberry Pis
caused by upgrading Debian Buster to Bullseye. The outage wasn&#x27;t a
because of a bug in Bullseye, the upgrade modified some parameters
&lt;code&gt;&#x2F;boot&#x2F;firmware&#x2F;config.txt&lt;&#x2F;code&gt; which, for some reason, prevented the board
from booting.&lt;&#x2F;p&gt;
&lt;p&gt;Also around the same period, my place was being renovated, and the
construction workers had nicked the main power supply lines. As a
result, we were experiencing some wild voltage fluctuations and power
outages. I thought I burnt my boards from either one of these two
things. It was time to set up a proper backup mechanism.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;requirement&quot;&gt;Requirement&lt;&#x2F;h2&gt;
&lt;p&gt;I have roughly 3 TB of storage across multiple devices and none of these
were being backed up. Going by the
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Backup#3-2-1_rule&quot;&gt;3-2-1&lt;&#x2F;a&gt;, I would
require at least 9 TB + 3 TB of storage(3*3 + some additional space for
versioned backups --- most backup systems these days are chunk snapshot
systems so versioning is very efficient). But since I&#x27;m broke and can&#x27;t
afford offsite storage, my requirements are down to 6 TB + 2 TB.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;my-current-solution&quot;&gt;My current solution&lt;&#x2F;h2&gt;
&lt;p&gt;I bought two 4 TB disks and setup &lt;a href=&quot;https:&#x2F;&#x2F;www.borgbackup.org&#x2F;&quot;&gt;Borg&lt;&#x2F;a&gt;
backup jobs to run at night. I currently have 7 daily, 4 weekly and 4
monthly snapshots on the first disk and the second disk contains 4
weekly and 4 monthly snapshots, and is unplugged and stored at a
different part of the house.&lt;&#x2F;p&gt;
&lt;p&gt;Ideally, it should be plugged in at a different part of the house, away
from my server rack, but I neither have the hardware nor the
infrastructure to implement that.&lt;&#x2F;p&gt;
&lt;h2 id=&quot;ideal-solution&quot;&gt;Ideal solution&lt;&#x2F;h2&gt;
&lt;p&gt;My current set up will work in most cases. I live in a calm neighborhood
in a very safe city(not prone to natural calamities and such) but
&lt;em&gt;ideally&lt;&#x2F;em&gt; there should be at least one copy of offsite backup. So I did
some math to see how much it would cost me:&lt;&#x2F;p&gt;
&lt;h3 id=&quot;aws-s3&quot;&gt;AWS S3&lt;&#x2F;h3&gt;
&lt;p&gt;AWS is usually the cheapest and there&#x27;s probably an adapter available
for Borg&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pricing:&lt;&#x2F;strong&gt; &lt;a href=&quot;https:&#x2F;&#x2F;aws.amazon.com&#x2F;s3&#x2F;pricing&#x2F;&quot;&gt;$0.023&#x2F;GB-month for the first
50 TB&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;cost:&lt;&#x2F;strong&gt; $0.023 * 3 * 1024 = $70.656&#x2F;month&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;But I don&#x27;t like AWS or anything Amazon&lt;&#x2F;p&gt;
&lt;h3 id=&quot;tarsnap&quot;&gt;Tarsnap&lt;&#x2F;h3&gt;
&lt;p&gt;Tarsnap is developed by &lt;a href=&quot;https:&#x2F;&#x2F;www.daemonology.net&#x2F;blog&#x2F;&quot;&gt;Dr. Colin
Percival&lt;&#x2F;a&gt; and is quite popular.&lt;&#x2F;p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;pricing:&lt;&#x2F;strong&gt; &lt;a href=&quot;https:&#x2F;&#x2F;www.tarsnap.com&#x2F;&quot;&gt;$0.25&#x2F;GB-month + $0.25&#x2F;GB
bandwidth&lt;&#x2F;a&gt;&lt;&#x2F;li&gt;
&lt;li&gt;&lt;strong&gt;cost:&lt;&#x2F;strong&gt; $0.25 * 3 * 1024 = $768&#x2F;month + bandwidth costs&lt;&#x2F;li&gt;
&lt;&#x2F;ul&gt;
&lt;p&gt;And is also quite expensive!&lt;&#x2F;p&gt;
&lt;p&gt;I can&#x27;t afford either of these solutions. My current setup set cost me
roughly ₹16,000 or $220 or the two months worth of AWS rent. Which is
ridiculous. So here&#x27;s my proposal:&lt;&#x2F;p&gt;
&lt;p&gt;As the internet becomes more diverse and more decentralised, home
servers will become a common thing. This means more folks, like myself,
will be on the lookout for cheap backup and failover solutions.
Normally, these home servers won&#x27;t be at 100% utilization(I&#x27;m currently
at 20% across the fleet) so forming rings of trust among friends and
family will be mutually beneficial. This way, the participants within
the ring can rely on each other&#x27;s facilities for backups and
failover situations for a fraction of what a cloud-based solution would
cost.&lt;&#x2F;p&gt;
&lt;p&gt;Of course, there should be proper measures taken to prevent unauthorized
access and trespassing, but they are implementation details.&lt;&#x2F;p&gt;
</content>
	</entry>
	<entry xml:lang="en">
		<title>NAT Troubles or how my ISP screwed me over</title>
		<published>2021-07-18T00:00:00+00:00</published>
		<updated>2021-07-18T00:00:00+00:00</updated>
		<link href="https://batsense.net/blog/18-07-21-nat-troubles/" type="text/html"/>
		<id>https://batsense.net/blog/18-07-21-nat-troubles/</id>
		<content type="html">&lt;p&gt;Couple of days ago, I woke with my inbox filled with alerts from my
&lt;a href=&quot;https:&#x2F;&#x2F;stats.uptimerobot.com&#x2F;EQ7VJHWylx&quot;&gt;monitoring service&lt;&#x2F;a&gt;, the
dashboard was lit up like a Christmas tree. I&#x27;m not new to having
downtimes, but this was the most unusual one: the servers were alright,
the internet connection was fine, but the services were
inaccessible. I had a bad feeling about this one.&lt;&#x2F;p&gt;
&lt;p&gt;&lt;img src=&quot;&#x2F;img&#x2F;blog&#x2F;18-07-21-NAT-troubles&#x2F;inbox-nightmare.png&quot; alt=&quot;Inbox full of alerts&quot; &#x2F;&gt;&lt;&#x2F;p&gt;
&lt;p&gt;You see, most of my internet presence comes out of my bedroom. This
website, my search engine, and even &lt;a href=&quot;https:&#x2F;&#x2F;matrix.org&quot;&gt;my favourite instant
messaging platform&lt;&#x2F;a&gt; is operated right out of my
bedroom. This has been possible because I&#x27;ve had a publicly accessible
IP address. It&#x27;s dynamically allocated but thanks to
&lt;a href=&quot;https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Dynamic_DNS&quot;&gt;DDNS&lt;&#x2F;a&gt;, it works! Everything
was fine until my ISP decided to put me behind a NAT. I told them that
I&#x27;m okay with paying for a static IP, but they said they only offer
static IPs for enterprise accounts. I love my ISP, I think they are
great but a static IP costs ₹200&#x2F;month(~$3) only, but they want me to
upgrade to a plan that costs four times more than what I&#x27;m paying now.&lt;&#x2F;p&gt;
&lt;p&gt;I can&#x27;t buy an enterprise connection and I can&#x27;t migrate the fleet to
the could because it&#x27;s expensive, and my parents will disown me. The only
logical option is to switch to an ISP that offers static IPs. But in the
meantime I have set up a tunnel between my servers and a cheap
DigitalOcean box using
&lt;a href=&quot;https:&#x2F;&#x2F;github.com&#x2F;fatedier&#x2F;frp#rewriting-the-http-host-header&quot;&gt;&lt;code&gt;frp&lt;&#x2F;code&gt;&lt;&#x2F;a&gt;.&lt;&#x2F;p&gt;
&lt;p&gt;It&#x27;s only been a few hours since the tunnel was set up but so far,
everything seems to be okay. There&#x27;s a client and a server component,
the client is run on machines behind NAT and the server on a machine
that&#x27;s exposed to the internet. The client connects to the server and
sets up a reverse tunnel. They support a wide range of protocols
including &lt;code&gt;HTTP&lt;&#x2F;code&gt;, &lt;code&gt;HTTPS&lt;&#x2F;code&gt;, &lt;code&gt;UDP&lt;&#x2F;code&gt; and &lt;code&gt;TCP&lt;&#x2F;code&gt;. Compared to my previous
setup, performance is a little
sluggish, but that&#x27;s expected since the application now sits behind
two reverse proxies instead of one. But it&#x27;s usable.&lt;&#x2F;p&gt;
&lt;p&gt;Here&#x27;s an example &lt;code&gt;frpc&lt;&#x2F;code&gt;(&lt;code&gt;frp&lt;&#x2F;code&gt; client) configuration for &lt;code&gt;HTTP&lt;&#x2F;code&gt; and
&lt;code&gt;HTTPS&lt;&#x2F;code&gt;:&lt;&#x2F;p&gt;
&lt;pre data-lang=&quot;ini&quot; style=&quot;background-color:#2b303b;color:#c0c5ce;&quot; class=&quot;language-ini &quot;&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[libreddit-https]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;= https
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;local_ip &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;127.0.0.1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;local_port &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;443
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;use_encryption &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;use_compression &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;host_header_rewrite &lt;&#x2F;span&gt;&lt;span&gt;= libreddit.batsense.net
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;custom_domains &lt;&#x2F;span&gt;&lt;span&gt;= libreddit.batsense.net
&lt;&#x2F;span&gt;&lt;span&gt;
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#b48ead;&quot;&gt;[libreddit]
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;type &lt;&#x2F;span&gt;&lt;span&gt;= http
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;local_ip &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;127.0.0.1
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;local_port &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;80
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;use_encryption &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;use_compression &lt;&#x2F;span&gt;&lt;span&gt;= &lt;&#x2F;span&gt;&lt;span style=&quot;color:#d08770;&quot;&gt;true
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;host_header_rewrite &lt;&#x2F;span&gt;&lt;span&gt;= libreddit.batsense.net
&lt;&#x2F;span&gt;&lt;span style=&quot;color:#bf616a;&quot;&gt;custom_domains &lt;&#x2F;span&gt;&lt;span&gt;= libreddit.batsense.net
&lt;&#x2F;span&gt;&lt;&#x2F;code&gt;&lt;&#x2F;pre&gt;
&lt;p&gt;Hopefully &lt;code&gt;IPv6&lt;&#x2F;code&gt; deployment increases and this post is rendered useless
but if there&#x27;s someone out there who&#x27;s trying to get past the NAT and
requires assistance, feel free to contact me!&lt;&#x2F;p&gt;
</content>
	</entry>
</feed>
